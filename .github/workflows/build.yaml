name: Build and Push Docker Image

on:
    push:
        branches:
            - main

env:
    REGISTRY: ghcr.io
    IMAGE_NAME: ${{github.repository}}

jobs:
    build-and-push-morbo-image:
        runs-on: ubuntu-latest
        permissions:
            contents: read
            packages: write

        steps:
            - name: "Checkout Repository"
              uses: actions/checkout@v4

            - name: "Login to GitHub Container Registry"
              uses: docker/login-action@v1
              with:
                  registry: ${{env.REGISTRY}}
                  username: ${{github.actor}}
                  password: ${{secrets.GITHUB_TOKEN}}

            - name: "Build and push Docker image"
              uses: docker/build-push-action@v4
              with:
                  context: .
                  push: true
                  tags: ${{env.REGISTRY}}/$(echo ${{ github.repository }} | tr '[:upper:]' '[:lower:]'):latest
                  file: ./morbo/Dockerfile
